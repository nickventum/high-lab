{"version":3,"file":"high-lab-core.mjs","sources":["../../../projects/core/src/lib/data-loading.ts","../../../projects/core/src/lib/subscription.helper.ts","../../../projects/core/src/public-api.ts","../../../projects/core/src/high-lab-core.ts"],"sourcesContent":["import { Observable } from 'rxjs';\r\n\r\nexport interface ApiPagination {\r\n    page?: number;\r\n    firstPage?: boolean;\r\n    lastPage?: boolean;\r\n    pageSize?: number;\r\n    totalElements?: number;\r\n    totalPages?: number;\r\n    sort?: string;\r\n}\r\n\r\nexport interface Pagination<T = any> {\r\n    data: T[];\r\n    pagination: ApiPagination;\r\n}\r\n\r\nexport interface FailureConfig {\r\n    properties: { [key: string]: any };\r\n    title?: string;\r\n    second?: boolean;\r\n}\r\n\r\nfunction empty(v: any): boolean {\r\n    return v === '' || (Array.isArray(v) && v.length === 0) || v === undefined || v === null || (typeof v === 'object' && Object.keys(v).length === 0);\r\n}\r\n\r\nexport class LoadingProgress<T> {\r\n    public static fromData<T>(value: T): LoadingProgress<T> {\r\n        return new LoadingProgress<T>(true, true, false, value)\r\n    }\r\n\r\n    public get isLoading(): boolean {\r\n        return !this.isLoaded;\r\n    }\r\n\r\n    public data: T extends Pagination ? T['data'] : T;\r\n    public pagination: ApiPagination | null;\r\n    public isEmptyData: boolean | null;\r\n\r\n    constructor(\r\n        public isLoaded: boolean = false,\r\n        public isSuccess: boolean = false,\r\n        public isFailure: boolean = false,\r\n        data?: T,\r\n        public failureConfig?: FailureConfig\r\n    ) {\r\n        if (this.hasPagination(data)) {\r\n            this.data = data.data as any;\r\n            this.pagination = data.pagination;\r\n        } else {\r\n            this.data = data as any;\r\n        }\r\n\r\n        this.isEmptyData = empty(this.data);\r\n    }\r\n\r\n    public clone<N>(params: {\r\n        isLoaded?: boolean,\r\n        isSuccess?: boolean,\r\n        isFailure?: boolean,\r\n        data: N,\r\n        failureConfig?: FailureConfig\r\n    } = {} as any): LoadingProgress<N> {\r\n        return new LoadingProgress(\r\n            params.isLoaded || this.isLoaded,\r\n            params.isSuccess || this.isSuccess,\r\n            params.isFailure || this.isFailure,\r\n            params.data,\r\n            params.failureConfig || this.failureConfig,\r\n        );\r\n    }\r\n\r\n    private hasPagination(data: Pagination | T): data is Pagination {\r\n        return data !== null && typeof data === 'object' && data.hasOwnProperty('pagination');\r\n    }\r\n}\r\n\r\nexport const dataLoading = <T>(\r\n    callback: (loadingProgress: LoadingProgress<T>) => void,\r\n    failureConfig?: FailureConfig\r\n) => (source: Observable<T>) => {\r\n    const tryCallCallback = (loadingProgress: LoadingProgress<T>) => {\r\n        if (typeof callback === 'function') {\r\n            callback(loadingProgress);\r\n        }\r\n    };\r\n\r\n    tryCallCallback(new LoadingProgress(false, false, false));\r\n\r\n    return new Observable<T>(observer => {\r\n        return source.subscribe(\r\n            v => {\r\n                tryCallCallback(new LoadingProgress(true, true, false, v));\r\n                observer.next(v);\r\n            },\r\n            err => {\r\n                tryCallCallback(new LoadingProgress(true, false, true, null, failureConfig));\r\n\r\n                observer.error(err);\r\n            },\r\n            () => {\r\n                observer.complete();\r\n            }\r\n        );\r\n    });\r\n};\r\n","import { Subscription } from 'rxjs';\r\n\r\nexport type Listener = Subscription | (() => void) | SubscriptionHelper;\r\n\r\nexport class SubscriptionHelper {\r\n    private static cases = new Map<(item) => any, (item) => any>()\r\n\r\n    public static registerCase<T>(comparator: (item: T) => any, unsubscriber: (item: T) => void): void {\r\n        this.cases.set(comparator, unsubscriber);\r\n    }\r\n\r\n    private subscriptions: Array<Listener> = [];\r\n\r\n    public set next(subscription: Listener) {\r\n        this.subscriptions.push(subscription);\r\n    }\r\n\r\n    public get last(): Listener {\r\n        return this.subscriptions[this.subscriptions.length - 1];\r\n    }\r\n\r\n    public unsubscribeAll(): void {\r\n        this.subscriptions.forEach(item => {\r\n            for (let entry of SubscriptionHelper.cases.entries()) {\r\n                if (entry[0](item)) {\r\n                    entry[1](item);\r\n                    break;\r\n                }\r\n            }\r\n        });\r\n\r\n        this.subscriptions = [];\r\n    }\r\n}\r\n\r\nSubscriptionHelper.registerCase<Subscription>(v => v instanceof Subscription, v => v.unsubscribe());\r\nSubscriptionHelper.registerCase<SubscriptionHelper>(v => v instanceof SubscriptionHelper, v => v.unsubscribeAll());\r\nSubscriptionHelper.registerCase<() => void>(v => typeof v === 'function', v => v())\r\n","/*\r\n * Public API Surface of core\r\n */\r\n\r\nexport * from './lib/data-loading';\r\nexport * from './lib/subscription.helper';\r\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":"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"}